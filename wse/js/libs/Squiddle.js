var Squiddle=function(a,b){"use strict";a=a||{log:function(){},dir:function(){}};b=b||{};var c,d;c=function(b){b=b||{};if(!(this instanceof c)){return new c(b)}this.debug=b.debug||false;this.interceptErrors=b.interceptErrors||false;this.log=b.log||false;this.logData=b.logData||false;this.callbacks={"*":[]};var d=this,e;e=function(b,c){if(d.debug!==true){return}var e=b.error.name||"Error";a.log(e+" in listener; Event: "+b.info.event+"; Message: "+b.error.message)};this.subscribe(e,"squiddle.error")};c.create=function(a){a=a||{};return new c(a)};c.prototype.subscribe=function(a,b){if(typeof b!=="undefined"&&typeof b!=="string"&&typeof b!=="number"){throw new Error("Event names can only be strings or numbers!")}if(typeof a!=="function"){throw new Error("Only functions may be used as listeners!")}b=b||"*";this.callbacks[b]=this.callbacks[b]||[];this.callbacks[b].push(a);this.trigger("squiddle.subscribe",{listener:a,event:b,bus:this})};c.prototype.unsubscribe=function(a,b){if(typeof b!=="undefined"&&typeof b!=="string"&&typeof b!=="number"){throw new Error("Event names can only be strings or numbers!")}b=b||"*";var c=this.callbacks[b]||[],d=c.length,e;for(e=0;e<d;++e){if(c[e]===a){this.callbacks[b].splice(e,1)}}this.trigger("squiddle.unsubscribe",{listener:a,event:b,bus:this})};c.prototype.trigger=function(b,c,e){if(typeof b!=="undefined"&&typeof b!=="string"&&typeof b!=="number"){throw new Error("Event names can only be strings or numbers!")}b=b||"*";c=c||null;e=typeof e!=="undefined"&&e===false?false:true;var f,g,h,i,j,k,l=this;f=function(){var a,c,d,e,f,g,h="",i=[];c=b.split(".");for(a=0,d=c.length;a<d;++a){h=h+(a>0?".":"")+c[a];e=l.callbacks[h]||[];for(f=0,g=e.length;f<g;++f){i.push(e[f])}}if(b==="*"){return i}e=l.callbacks["*"]||[];for(f=0,g=e.length;f<g;++f){i.push(e[f])}return i}();g=f.length;h={event:b,subscribers:g,getQueueLength:function(){if(g===0){return 0}return g-(i+1)}};d=function(a){setTimeout(function(){throw a},0)};j=function(){if(l.log===true){a.log("Squiddle event triggered: "+b+"; Subscribers: "+g,l.logData===true?"; Data: "+c:"")}for(i=0;i<g;++i){k=f[i];try{k(c,h)}catch(e){a.log("Error is: "+e);l.trigger("squiddle.error",{error:e,info:h});if(l.interceptErrors!==true){d(e)}}}};if(e===true){setTimeout(j,0)}else{j()}};c.inject=function(a,b){b=b||{};var d=new c(b);a.subscribe=function(a,b){b=b||"*";d.subscribe(a,b)};a.unsubscribe=function(a,b){b=b||"*";d.unsubscribe(a,b)};a.trigger=function(a,b,c){a=a||"*";b=b||null;c=typeof c!=="undefined"&&c===false?false:true;d.trigger(a,b,c)}};b.create=c;b.inject=c.inject;return c}(typeof console==="undefined"?false:console,typeof exports==="undefined"?false:exports)